<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€ - Pigrange&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="æˆ‘ä¸ç®¡ä½ çœ‹ä¸çœ‹å¾—æ‡‚ï¼Œåæ­£è¿™ä¸€æ¬¡æˆ‘ä¹Ÿæ²¡æœ‰çœ‹æ‡‚ ğŸ˜­ â€”â€” john pig  Androidå¤ªéš¾äº†ã€‚æˆ‘å¤ªå—äº†ã€‚">
<meta name="keywords" content="Android,SourceCode">
<meta property="og:type" content="article">
<meta property="og:title" content="Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€">
<meta property="og:url" content="https://pigrange.github.io/2019/09/23/View-process-2/index.html">
<meta property="og:site_name" content="Pigrange&#39;s Blog">
<meta property="og:description" content="æˆ‘ä¸ç®¡ä½ çœ‹ä¸çœ‹å¾—æ‡‚ï¼Œåæ­£è¿™ä¸€æ¬¡æˆ‘ä¹Ÿæ²¡æœ‰çœ‹æ‡‚ ğŸ˜­ â€”â€” john pig  Androidå¤ªéš¾äº†ã€‚æˆ‘å¤ªå—äº†ã€‚">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://pigrange.github.io/assets/gallery/thumbnails/SourceCode.jpg">
<meta property="og:updated_time" content="2019-09-24T12:21:56.389Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€">
<meta name="twitter:description" content="æˆ‘ä¸ç®¡ä½ çœ‹ä¸çœ‹å¾—æ‡‚ï¼Œåæ­£è¿™ä¸€æ¬¡æˆ‘ä¹Ÿæ²¡æœ‰çœ‹æ‡‚ ğŸ˜­ â€”â€” john pig  Androidå¤ªéš¾äº†ã€‚æˆ‘å¤ªå—äº†ã€‚">
<meta name="twitter:image" content="https://pigrange.github.io/assets/gallery/thumbnails/SourceCode.jpg">







<link rel="icon" href="/assets/img/logo.jpg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/androidstudio.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/assets/img/logo.jpg" alt="Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">ä¸»é¡µ</a>
                
                <a class="navbar-item" href="/categories">åˆ†ç±»</a>
                
                <a class="navbar-item" href="/archives">å½’æ¡£</a>
                
                <a class="navbar-item" href="/tags">æ ‡ç­¾</a>
                
                <a class="navbar-item" href="/about">å…³äºæˆ‘</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="æœç´¢" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-10-tablet is-8-desktop is-8-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                    Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€
                    
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-09-23T06:35:36.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-09-23</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2019-09-24T12:21:56.389Z"><i class="far fa-calendar-check">&nbsp;</i>2019-09-24</time>
                
                
                <div class="level-item">
                    <a class="has-link-grey -link" href="/categories/æºç é˜…è¯»/">æºç é˜…è¯»</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/æºç é˜…è¯»/Viewå·¥ä½œæµç¨‹/">Viewå·¥ä½œæµç¨‹</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 2323 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        

        <div class="content">
            <p><em>æˆ‘ä¸ç®¡ä½ çœ‹ä¸çœ‹å¾—æ‡‚ï¼Œåæ­£è¿™ä¸€æ¬¡æˆ‘ä¹Ÿæ²¡æœ‰çœ‹æ‡‚</em> ğŸ˜­ <em>â€”â€” john pig</em> </p>
<p>Androidå¤ªéš¾äº†ã€‚æˆ‘å¤ªå—äº†ã€‚</p>
<a id="more"></a>

<p><code>ViewRootImpl#PerformTraversals()</code><br><code>ViewRootImpl#performLayout(lp, mWidth, mHeight)</code><br><code>DecorView#layout()</code></p>
<p><strong>å†™åœ¨å‰é¢ï¼š</strong></p>
<p>è¿™çœŸçš„æ˜¯åˆ°ç›®å‰çœ‹çš„æœ€ç´¯çš„ä¸€æ¬¡ï¼Œæˆ‘ï¼ŒçœŸçš„æ˜¯çœ‹ä¸ä¸‹å»äº†(æˆ‘æŒ‡çš„æ˜¯ViewRootImptçš„performLayoutæ–¹æ³•)ï¼Œå¤ªéš¾äº†ï¼Œdebugè·³è¿‡å»è°ƒè¿‡æ¥çš„ï¼Œé€’å½’çœ‹ç€æ˜¯çœŸçš„æ¼ç«ï¼Œæ‰€ä»¥å¯¹é‚£é‡ŒæŸä¸€äº›æºç çš„éƒ¨åˆ†æè¿°æˆ‘å°±æ‰“ç®—è¯´ä¸€ä¸ªå¤§æ¦‚äº†ã€‚çœŸçš„æ˜¯åœ¨è¿™ä¸ªä¸Šé¢ç†¬äº†ä¸å°‘çš„æ—¶é—´ï¼Œä½†æ˜¯æˆ‘ç‰¹ä¹ˆçœŸçš„æ˜¯çœ‹ä¸æ‡‚å•Šï¼Œé€’å½’è¿‡å»é€’å½’è¿‡æ¥æˆ‘æ€ä¹ˆçŸ¥é“é€’å½’åˆ°é‚£é‡Œå»äº†å‘¢ï¼Ÿ</p>
<p>å…¶ä»–çš„æˆ‘ä¹Ÿä¸åšè¿‡å¤šçš„æè¿°äº†ï¼Œä¸ªäººè§‰å¾—è¿™ç¯‡æ–‡ç« é•¿åº¦è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯å†…å®¹ä¿¡æ¯é‡æŒºå¤§ï¼Œå»ºè®®ä¸€éDEBUGä¸€è¾¹çœ‹ã€‚å¦å¤–è¿™ç¯‡æ–‡ç« çš„æ³¨é‡Šå·²ç»å†™çš„å¾ˆè¯¦ç»†äº†ï¼Œå°±ä¸åšè¿‡å¤šçš„æ–‡å­—æè¿°äº†ï¼Œåé¢å¦‚æœæœ‰ç©ºçš„è¯ï¼Œä¼šè¡¥ä¸€ä¸ªViewGroupçš„onLayoutæ–¹æ³•çš„è§£æï¼Œä»Šå¤©å¤ªç´¯äº†ï¼Œå°±å…ˆğŸ•Šäº†ã€‚</p>
<h4 id="performLayout"><a href="#performLayout" class="headerlink" title="performLayout"></a>performLayout</h4><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ViewRootImpl#performLayout</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">performLayout</span><span class="hljs-params">(WindowManager.LayoutParams lp, <span class="hljs-keyword">int</span> desiredWindowWidth,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                           <span class="hljs-keyword">int</span> desiredWindowHeight)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è¿™ä¸ªæ ‡è¯†ç¬¦ç”¨äºæ ‡è¯†æ­¤Viewæ˜¯å¦åœ¨è¿›è¡ŒLayout</span></span><br><span class="line">    <span class="hljs-comment">//å› ä¸ºä¸‹ä¸€æ­¥å°±æ˜¯è¿›è¡ŒLayoutäº†ï¼Œæ‰€ä»¥è¿™é‡Œå°†å…¶è®¾ç½®ä¸ºtrue</span></span><br><span class="line">    mInLayout = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œçš„Hostå°±æ˜¯æˆ‘ä»¬çš„decorView</span></span><br><span class="line">    <span class="hljs-keyword">final</span> View host = mView;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è°ƒç”¨hostçš„layoutæ–¹æ³•ï¼Œå³åœ¨è¿™é‡Œè°ƒç”¨DecorViewçš„layoutæ–¹æ³•</span></span><br><span class="line">    host.layout(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, host.getMeasuredWidth(), host.getMeasuredHeight());</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//Lyoutå®Œåå°†å…¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">    mInLayout = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰Viewåœ¨è¿›è¡ŒLayoutçš„è¿‡ç¨‹ä¸­è°ƒç”¨äº†RequestLayoutæ–¹æ³•</span></span><br><span class="line">    <span class="hljs-keyword">int</span> numViewsRequestingLayout = mLayoutRequesters.size();</span><br><span class="line">    <span class="hljs-keyword">if</span> (numViewsRequestingLayout &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//è¿‡æ»¤ä¸€äº›å·²ç»è¢«è§£å†³çš„child view</span></span><br><span class="line">        ArrayList&lt;View&gt; validLayoutRequesters = getValidLayoutRequesters(mLayoutRequesters,</span><br><span class="line">                                                                         <span class="hljs-keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (validLayoutRequesters != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//å°†è¿™ä¸ªæ ‡å¿—ä½ç½®ä¸ºTrueï¼Œä½œä¸ºrequestLayoutçš„ä¸€ä¸ªåˆ¤æ–­æ ‡è¯†</span></span><br><span class="line">            <span class="hljs-comment">//ä¸‹é¢æˆ‘ä»¬ä¼šè°ƒç”¨ç¼“å­˜çš„Viewçš„requestLayoutæ–¹æ³•</span></span><br><span class="line">            <span class="hljs-comment">//ç”±äºä¹‹å‰çš„ViewTreeçš„æ•´ä¸ªLayoutå·²ç»ç»“æŸäº†</span></span><br><span class="line">            <span class="hljs-comment">//æ‰€ä»¥Force_Layoutæ ‡è¯†å·²ç»è¢«ç½®ä¸ºäº†0</span></span><br><span class="line">            <span class="hljs-comment">//æ‰€ä»¥ä¹‹åViewè°ƒç”¨requestLayout</span></span><br><span class="line">            <span class="hljs-comment">//æ¡ä»¶åˆ¤æ–­mParent.isLayoutRequested()ä¼šè¿”å›false</span></span><br><span class="line">            <span class="hljs-comment">//è¿™ä¼šå¯¼è‡´æ•´ä¸ªViewTreeå‘ä¸Šé€’å½’requestLayout</span></span><br><span class="line">            <span class="hljs-comment">//æœ€ç»ˆè°ƒç”¨ViewRootImplçš„requestLayoutæ–¹æ³•</span></span><br><span class="line">            <span class="hljs-comment">//ä½†æ˜¯ViewRootImplçš„requestLayoutä¼šå¯¼è‡´</span></span><br><span class="line">            <span class="hljs-comment">//å…¶performTraversalçš„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šå¯¼è‡´</span></span><br><span class="line">            <span class="hljs-comment">//PerfromLayoutè¿™ä¸ªæ–¹æ³•è¢«é€’å½’è°ƒç”¨</span></span><br><span class="line">            <span class="hljs-comment">//è€ƒè™‘åˆ°æ€§èƒ½çš„é—®é¢˜ï¼Œæœ‰å¾ˆå¤šé€»è¾‘æ˜¯ä¸éœ€è¦çš„</span></span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-comment">//æ‰€ä»¥è¿™ä¸ªæ ‡è¯†çš„ä½œç”¨å°±æ˜¯æ‹¦æˆªViewRootImplæ¥å—layoutçš„è¯·æ±‚</span></span><br><span class="line">            <span class="hljs-comment">//é€šè¿‡åœ¨performLayoutä¸­çš„æŸäº›é€»è¾‘æ¥è§£å†³ã€‚</span></span><br><span class="line">            mHandlingLayoutInLayoutRequest = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//éå†æ•´ä¸ªnumValidRequests, å¯¹æ¯ä¸€ä¸ªviewè°ƒç”¨requestLayout</span></span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œçš„requestLayoutçš„ä½œç”¨æ˜¯å°†å…¶çˆ¶Viewé“¾çš„FORCE_LAYOUTæ ‡å¿—ä½</span></span><br><span class="line">            <span class="hljs-comment">//å…¨éƒ¨è®¾ç½®ä¸º1ï¼Œä½†æ˜¯å¹¶ä¸ä¼šçœŸæ­£çš„åœ¨è¿™é‡Œå¯¹å…¶layout</span></span><br><span class="line">            <span class="hljs-keyword">int</span> numValidRequests = validLayoutRequesters.size();</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numValidRequests; ++i) &#123;</span><br><span class="line">                <span class="hljs-keyword">final</span> View view = validLayoutRequesters.get(i);</span><br><span class="line">                view.requestLayout();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//å¯¹ViewTreeè¿›è¡Œæµ‹é‡ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬ä¹‹å‰çœ‹è¿‡measureçš„ä»£ç çŸ¥é“</span></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œåªæœ‰è¢«æ ‡å¿—ä½FORCE_LAYOUTçš„Viewæ‰ä¼šå†æ¬¡è¢«æµ‹é‡</span></span><br><span class="line">            <span class="hljs-comment">//ä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä»¬requestçš„é‚£ä¸ªViewé“¾</span></span><br><span class="line">            measureHierarchy(host, lp, mView.getContext().getResources(),</span><br><span class="line">                             desiredWindowWidth, desiredWindowHeight);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//å°†Layoutæ ‡è¯†ç½®ä¸ºTrueï¼Œæ ‡è¯†å³å°†è¿›è¡ŒLayout</span></span><br><span class="line">            mInLayout = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//è¿›è¡ŒViewTreeçš„å†æ¬¡Layout</span></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œå¦‚æœchildå†æ¬¡è°ƒç”¨äº†requestLayoutçš„è¯</span></span><br><span class="line">            <span class="hljs-comment">//å¤„ç†ç­–ç•¥ä¸€æ ·ï¼ŒåªæŠŠå½“å‰è°ƒç”¨requestLayoutçš„View</span></span><br><span class="line">            <span class="hljs-comment">//åŠ å…¥åˆ°mLayoutRequestersä¸­å³å¯ï¼Œä¸ä¼šå½±å“parent</span></span><br><span class="line">            host.layout(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, host.getMeasuredWidth(), host.getMeasuredHeight());</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//å°†mHandlingLayoutInLayoutRequestç½®ä¸ºfalse</span></span><br><span class="line">            <span class="hljs-comment">//è¿™ä¸ªæ—¶å€™å‰é¢çš„Layoutå·²ç»å®Œæˆäº†</span></span><br><span class="line">            mHandlingLayoutInLayoutRequest = <span class="hljs-keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œçš„ä»£ç æ˜¯ç”¨æ¥è§£å†³Viewå‡ºç°æ— å°½çš„é€’å½’è°ƒç”¨requestLayoutçš„</span></span><br><span class="line">            <span class="hljs-comment">//æ¯”å¦‚ä¸Šè¿°layoutä¸­childåˆè°ƒç”¨äº†requestLayout</span></span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-comment">//æ³¨é‡Šæˆ‘çœ‹çš„ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¸»è¦æ˜¯ç†è§£ä¸åˆ°é‚£ä¸ªå¥‡æ€ªçš„ noop'd æ˜¯ä»€ä¹ˆæ„æ€</span></span><br><span class="line">            <span class="hljs-comment">//ä¸è¿‡æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œå¤§æ¦‚å°±æ˜¯Androidå¯¹äºè¿™ä¸ªé‡å¤æ— æ„ä¹‰çš„requestLayoutæœ‰æ£€æµ‹æœºåˆ¶</span></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œå°±æ˜¯å°†è¿™äº›Viewé€ç»™ç›¸å…³çš„åˆ¤æ–­é€»è¾‘</span></span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-comment">//çŒœæµ‹ç”¨runnable queueçš„åŸå› ï¼š</span></span><br><span class="line">            <span class="hljs-comment">//é˜²æ­¢performLayoutå¤ªè€—æ—¶ä»¥è‡³äºç³»ç»Ÿå¡é¡¿æˆ–è€…é•¿æ—¶é—´æœªå“åº”</span></span><br><span class="line">            <span class="hljs-comment">//ä¹Ÿç®—æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥å§</span></span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-comment">//è¿™é‡Œæˆ‘æœ‰è¯•è¿‡ç›´æ¥åœ¨Viewçš„onLayouté‡Œè°ƒç”¨requestLayout</span></span><br><span class="line">            <span class="hljs-comment">//æœ€ç»ˆå‘ç°ViewRootImplçš„performLayoutå¤§æ¦‚ä¼šåœ¨è°ƒç”¨äº†3æ¬¡å</span></span><br><span class="line">            <span class="hljs-comment">//å°±ä¸ä¼šå†è°ƒç”¨äº†ï¼Œå¯è§è¿™ç§æ— æ•ˆçš„æ–¹æ³•ç³»ç»Ÿæ˜¯æœ‰æ£€æµ‹æœºåˆ¶çš„</span></span><br><span class="line">            <span class="hljs-comment">//ä½†æ˜¯ç”±äºæœ¬äººçš„èƒ½åŠ›æœ‰é™ï¼Œæ‰€ä»¥ä¸åšè¿‡å¤šæè¿°</span></span><br><span class="line">            validLayoutRequesters = getValidLayoutRequesters(mLayoutRequesters, <span class="hljs-keyword">true</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (validLayoutRequesters != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; finalRequesters = validLayoutRequesters;</span><br><span class="line">                getRunQueue().post(<span class="hljs-keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="hljs-meta">@Override</span></span><br><span class="line">                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">                        <span class="hljs-keyword">int</span> numValidRequests = finalRequesters.size();</span><br><span class="line">                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numValidRequests; ++i) &#123;</span><br><span class="line">                            <span class="hljs-keyword">final</span> View view = finalRequesters.get(i);</span><br><span class="line">                            Log.w(<span class="hljs-string">"View"</span>, <span class="hljs-string">"requestLayout() improperly called by "</span> + view +</span><br><span class="line">                                  <span class="hljs-string">" during second layout pass: posting in next frame"</span>);</span><br><span class="line">                            view.requestLayout();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment">//æœ€åæŠŠmInLayout ç½®ä¸ºfalse</span></span><br><span class="line">mInLayout =<span class="hljs-keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h4><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//View#layout</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">layout</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> t, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> b)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUTåªæœ‰åœ¨ä¹‹å‰çš„measureæ–¹æ³•</span></span><br><span class="line">    <span class="hljs-comment">//ç›´æ¥æ‹¿çš„ç¼“å­˜è®¾ç½®çš„measuredWidthå’ŒmeasuredHeightçš„æ—¶å€™æ‰ä¼šä½¿ç”¨</span></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œä¸åšè¿‡å¤šçš„æè¿°</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        onMeasure(mOldWidthMeasureSpec, mOldHeightMeasureSpec);</span><br><span class="line">        mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è®°å½•ä¹‹å‰çš„å››ä¸ªé¡¶ç‚¹</span></span><br><span class="line">    <span class="hljs-keyword">int</span> oldL = mLeft;</span><br><span class="line">    <span class="hljs-keyword">int</span> oldT = mTop;</span><br><span class="line">    <span class="hljs-keyword">int</span> oldB = mBottom;</span><br><span class="line">    <span class="hljs-keyword">int</span> oldR = mRight;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//æ ¹æ®Viewæ˜¯å¦å…·æœ‰å…‰å­¦è¾¹ç•Œï¼Œè°ƒç”¨ä¸åŒç±»å‹çš„setFrameæ–¹æ³•</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//å¼ºè°ƒï¼šViewçš„å››ä¸ªé¡¶ç‚¹å°±æ˜¯åœ¨è¿™é‡Œé¢è¢«ç¡®å®šçš„</span></span><br><span class="line">    <span class="hljs-comment">//ä½†æ˜¯è¿™é‡Œé¢è®¾ç½®çš„æ­¤Viewçš„å››ä¸ªé¡¶ç‚¹çš„ä½ç½®</span></span><br><span class="line">    <span class="hljs-comment">//å¯¹äºå“ªäº›åŒ…å«æœ‰childçš„Viewï¼Œå¯èƒ½è¿˜éœ€è¦è®¾ç½®childçš„ä½ç½®</span></span><br><span class="line">    <span class="hljs-comment">//è€Œå¯¹childå››ä¸ªé¡¶ç‚¹ä½ç½®çš„ç¡®å®šï¼Œæˆ‘ä»¬å°±å†™åœ¨onLayouté‡Œé¢</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œè¿”å›çš„å€¼æ˜¯æ–°çš„å››ä¸ªé¡¶ç‚¹æ˜¯å¦å’Œä¹‹å‰çš„å››ä¸ªé¡¶ç‚¹ä¸€æ ·</span></span><br><span class="line">    <span class="hljs-keyword">boolean</span> changed = isLayoutModeOptical(mParent) ?</span><br><span class="line">        setOpticalFrame(l, t, r, b) : setFrame(l, t, r, b);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡åé¢çš„æ ‡å¿—</span></span><br><span class="line">    <span class="hljs-comment">//ä½†æ˜¯å¯ä»¥è¿™ä¹ˆè®°ä¸€ä¸‹ï¼Œå°±æ˜¯åªè¦Viewè¢«è°ƒç”¨äº†measure</span></span><br><span class="line">    <span class="hljs-comment">//é‚£ä¹ˆåé¢çš„æ¡ä»¶å°±ä¸€å®šæˆç«‹</span></span><br><span class="line">    <span class="hljs-comment">//è€Œè¿™é‡Œçš„changedä¸»è¦æ˜¯ç”¨æ¥è§£å†³Viewä»…æ”¹å˜äº†ä½ç½®çš„æƒ…å†µ</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//Viewé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—æ¥è¯´å…¶å®æ˜¯æ¯”è¾ƒé‡è¦çš„æ–¹æ³•</span></span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">        <span class="hljs-comment">//å¯¹äºè‡ªå®šä¹‰ViewGroupæ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºç¡®å®šå…¶childçš„ä½ç½®</span></span><br><span class="line">        <span class="hljs-comment">//å”¯äºŒå®ç°æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡å†™layoutï¼ˆéš¾åº¦è¾ƒå¤§ï¼‰</span></span><br><span class="line">        <span class="hljs-comment">//è¿™é‡Œä¼ å…¥çš„å››ä¸ªå‚æ•°æ˜¯ï¼ŒViewGroupçš„æœ€æ–°çš„å››ä¸ªé¡¶ç‚¹çš„ä½ç½®</span></span><br><span class="line">        <span class="hljs-comment">//å’Œå®ƒå¸Œæœ›é€šçŸ¥childè‡ªå·±æ˜¯å¦ä½ç½®æ”¹å˜çš„ä¸€ä¸ªæ ‡è¯†</span></span><br><span class="line">        <span class="hljs-comment">//~~åé¢æƒ³æ€ä¹ˆæchildçš„ä½ç½®å°±æ˜¯å¼€å‘è€…è‡ªå·±çš„äº‹æƒ…äº†</span></span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">        <span class="hljs-comment">//è¡¥å……ï¼šä¸å»ºè®®åœ¨onLayoutæ–¹æ³•é‡Œé¢é€šè¿‡æ‰‹åŠ¨è°ƒç”¨setFrameæ¥è®©View</span></span><br><span class="line">        <span class="hljs-comment">//åŸºäºæŸä¸€ä¸ªåˆå§‹ä½ç½®æœ‰ä¸€ä¸ªåç§»é‡,è™½ç„¶è¿™æ ·Viewçš„ä½ç½®ç¡®å®æ²¡æœ‰é—®é¢˜</span></span><br><span class="line">        <span class="hljs-comment">//ä½†æ˜¯ä¼šå¯¼è‡´åé¢listenerç›‘å¬çš„ä½ç½®æœ‰è¯¯</span></span><br><span class="line">        <span class="hljs-comment">//</span></span><br><span class="line">        <span class="hljs-comment">//ä¸ªäººè§‰å¾—æ¯”è¾ƒç†æƒ³çš„å®ç°æ˜¯åœ¨Viewçš„æ„é€ æ–¹æ³•é‡Œæ‰‹åŠ¨åŠ ä¸€ä¸ªmargin</span></span><br><span class="line">        <span class="hljs-comment">//è¿™æ ·æ‰èƒ½ä»æ ¹æœ¬ä¸Š(ä»é€šçŸ¥parentä¸Š)è§£å†³é—®é¢˜</span></span><br><span class="line">        onLayout(changed, l, t, r, b);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//ç§»é™¤PFLAG_LAYOUT_REQUIREDæ ‡è¯†</span></span><br><span class="line">        mPrivateFlags &amp;= ~PFLAG_LAYOUT_REQUIRED;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//å›è°ƒä¸€äº›Listenerçš„onLayoutChangeæ–¹æ³•</span></span><br><span class="line">        <span class="hljs-comment">//æ‰€ä»¥è¿™é‡Œä¹Ÿå¯ä»¥æ‹¿å¾—åˆ°Viewçš„åæ ‡ï¼Œå®½é«˜ç­‰å±æ€§</span></span><br><span class="line">        ListenerInfo li = mListenerInfo;</span><br><span class="line">        <span class="hljs-keyword">if</span> (li != <span class="hljs-keyword">null</span> &amp;&amp; li.mOnLayoutChangeListeners != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">            ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =</span><br><span class="line">                (ArrayList&lt;OnLayoutChangeListener&gt;) li.mOnLayoutChangeListeners.clone();</span><br><span class="line">            <span class="hljs-keyword">int</span> numListeners = listenersCopy.size();</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; numListeners; ++i) &#123;</span><br><span class="line">                listenersCopy.get(i).onLayoutChange(<span class="hljs-keyword">this</span>, l, t, r, b, oldL, oldT, oldR, oldB);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//...åˆ æ‰äº†å¤§é‡å’ŒViewç„¦ç‚¹æœ‰å…³çš„ä»£ç </span></span><br><span class="line">    <span class="hljs-comment">//åæ­£æˆ‘åˆçœ‹ä¸æ‡‚ï¼Œæ”¾åœ¨é‚£é‡Œå‡‘å­—æ•°å—ï¼Ÿ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å†æ¢RequestLayout"><a href="#å†æ¢RequestLayout" class="headerlink" title="å†æ¢RequestLayout"></a>å†æ¢RequestLayout</h4><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ViewParent#requestLayout</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestLayout</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//é¦–å…ˆï¼Œå‰é¢è¯´è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç¬¬ä¸€æ¬¡performTraversalçš„æ—¶å€™ä¸€å®šä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œè¯´ä¸€ä¸‹mViewRequestingLayoutè¿™ä¸ªæ ‡è¯†ç¬¦</span></span><br><span class="line">    <span class="hljs-comment">//å®ƒç”¨æ¥æ ‡è¯†æ•´ä¸ªViewTreeçœŸæ­£è°ƒç”¨requestLayoutçš„é‚£ä¸ªView</span></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œæ˜¯trueçš„è¯ï¼Œå°±è¯´æ˜æ­¤æ¬¡è°ƒç”¨requestLayoutçš„æ˜¯æ•´ä¸ª</span></span><br><span class="line">    <span class="hljs-comment">//requestLayoutäº‹ä»¶é“¾çš„ç½ªé­ç¥¸é¦–ï¼Œéœ€è¦å¯¹å®ƒè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„å¤„ç†</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mAttachInfo != <span class="hljs-keyword">null</span> &amp;&amp; mAttachInfo.mViewRequestingLayout == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        ViewRootImpl viewRoot = getViewRootImpl();</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//åªè¦ViewRootè°ƒç”¨äº†layouæ–¹æ³•ï¼Œè€Œchildåœ¨layoutä¸­åˆè°ƒç”¨äº†</span></span><br><span class="line">        <span class="hljs-comment">//requestLayout,é‚£ä¹ˆè¿™é‡Œçš„åˆ¤æ–­å°±æ˜¯trueï¼Œå°±ä¼šè°ƒç”¨ä¸‹é¢çš„</span></span><br><span class="line">        <span class="hljs-comment">//viewRoot.requestLayoutDuringLayout(this)æ–¹æ³•</span></span><br><span class="line">        <span class="hljs-comment">//è€Œè¿™ä¸ªæ–¹æ³•çš„å°±æ˜¯å°†è¿™ä¸ªviewåŠ å…¥åˆ°mLayoutRequestersä¸­çš„</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (viewRoot != <span class="hljs-keyword">null</span> &amp;&amp; viewRoot.isInLayout()) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!viewRoot.requestLayoutDuringLayout(<span class="hljs-keyword">this</span>)) &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">//å› ä¸ºä¸Šé¢æœ‰å¯èƒ½ä¼šreturn,è¿™æ®µè¯­å¥å’Œä¸Šé¢æœ¬æ¥æ˜¯æ²¡æœ‰å…³è”çš„</span></span><br><span class="line">        <span class="hljs-comment">//ä½†æ˜¯å¦‚æœä¸Šé¢returnçš„è¯ï¼Œå¯èƒ½ä¼šå¼•èµ·é”™è¯¯ï¼Œæ‰€ä»¥å°±æ”¾ä¸‹é¢</span></span><br><span class="line">        mAttachInfo.mViewRequestingLayout = <span class="hljs-keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//å°†Viewçš„PFLAG_FORCE_LAYOUTç½®ä¸º1</span></span><br><span class="line">    <span class="hljs-comment">//å°†Viewçš„PFLAG_INVALIDATEDç½®ä¸º1</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//INVALIDATEDæ ‡è¯†æš‚æ—¶è¿˜ä¸æ¸…æ¥šï¼Œä¸è¿‡çŒœæµ‹å’ŒViewçš„é‡æ–°ç»˜åˆ¶æœ‰å…³</span></span><br><span class="line">    <span class="hljs-comment">//FORCE_LAYOUTååˆ†é‡è¦ï¼Œå®ƒæ˜¯è¿™ä¸ªViewåœ¨åé¢çš„é‡æ–°measureå’Œlayout</span></span><br><span class="line">    <span class="hljs-comment">//ä¸­æ˜¯å¦çœŸçš„éœ€è¦è¢«æµ‹é‡çš„å®šä½çš„æ ‡è¯†</span></span><br><span class="line">    mPrivateFlags |= PFLAG_FORCE_LAYOUT;</span><br><span class="line">    mPrivateFlags |= PFLAG_INVALIDATED;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œçš„ä»£ç å—æ˜¯Viewé€’å½’å‘ä¸Šä¼ é€’requestLayoutçš„å…³é”®</span></span><br><span class="line">    <span class="hljs-comment">//è€Œè¿™é‡Œçš„åˆ¤æ–­è¯­å¥åˆæ˜¯æ˜¯å¦ä½¿å¾—viewå‘ä¸Šä¼ é€’äº‹ä»¶çš„æ ¸å¿ƒ</span></span><br><span class="line">    <span class="hljs-comment">//</span></span><br><span class="line">    <span class="hljs-comment">//isLayoutRequested æ–¹æ³•ä¼šåˆ¤æ–­å…¶parentçš„FORCE_LAYOUTæ˜¯å¦æ˜¯1</span></span><br><span class="line">    <span class="hljs-comment">//å¦‚æœå…¶PARENTæ˜¯åœ¨è¿›è¡Œlayoutçš„è¯ï¼Œé‚£ä¹ˆFORCE_LAYOUTå°†ä¼šæ˜¯1</span></span><br><span class="line">    <span class="hljs-comment">//è¿™ä¸ªæ ‡å¿—ä½ä¼šåœ¨onLayoutä¹‹åè¢«é‡ç½®ä¸º0ï¼Œä½†æ˜¯å¯¹childçš„layoutæ˜¯åœ¨</span></span><br><span class="line">    <span class="hljs-comment">//onLayoutä¸­å®ç°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™FORCE_LAYOUTä»ç„¶æ˜¯1</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mParent != <span class="hljs-keyword">null</span> &amp;&amp; !mParent.isLayoutRequested()) &#123;</span><br><span class="line">        mParent.requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">//è¿™é‡Œå¾ˆå¥½ç†è§£ï¼ŒæŠŠç½ªé­ç¥¸é¦–çš„æ ‡è¯†å–æ¶ˆäº†ï¼Œä¸åšå¤šçš„è§£é‡Š</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (mAttachInfo != <span class="hljs-keyword">null</span> &amp;&amp; mAttachInfo.mViewRequestingLayout == <span class="hljs-keyword">this</span>) &#123;</span><br><span class="line">        mAttachInfo.mViewRequestingLayout = <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¡¥ä¸€ä¸ªrequetLayoutæ–¹æ³•çš„æµç¨‹å›¾ï¼š</p>
<p><img src="https://github.com/pigrange/pigrange.github.io/blob/master/assets/img/view-process-2/requestLayout.png?raw=true" alt></p>

        </div>
        
        <ul class="post-copyright">
            <li><strong>æœ¬æ–‡æ ‡é¢˜ï¼š</strong><a href="https://pigrange.github.io/2019/09/23/View-process-2/">Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€</a></li>
            <li><strong>æœ¬æ–‡ä½œè€…ï¼š</strong><a href="https://pigrange.github.io">John Pig</a></li>
            <li><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://pigrange.github.io/2019/09/23/View-process-2/">https://pigrange.github.io/2019/09/23/View-process-2/</a></li>
            <li><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>2019-09-23</li>
            <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </li>
        </ul>
        
        
        <hr style="height:1px;margin:1rem 0">
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/Android/">Android</a>,&nbsp;<a class="has-link-grey -link" href="/tags/SourceCode/">SourceCode</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/09/22/å¯„å¤äºˆä½ /">
                <span class="level-item">å¯„å¤äºˆä½ </span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                        <figure class="image is-128x128 has-mb-6">
                            <img class="is-rounded" src="/assets/img/favicon.jpg" alt="pigrange">
                        </figure>
                    
                    
                    <p class="is-size-4 is-block">
                        pigrange
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        JohnPig
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>ChengDu China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        æ–‡ç« 
                    </p>
                    <p class="title has-text-weight-normal">
                        12
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        åˆ†ç±»
                    </p>
                    <p class="title has-text-weight-normal">
                        8
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        æ ‡ç­¾
                    </p>
                    <p class="title has-text-weight-normal">
                        5
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/pigrange" target="_blank">
                å…³æ³¨æˆ‘</a>
        </div>
        
        
    </div>
</div>
    
        
<div class="card widget column-left is-sticky" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                ç›®å½•
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#performLayout">
        <span class="has-mr-6">1</span>
        <span>performLayout</span>
        </a></li><li>
        <a class="is-flex" href="#Layout">
        <span class="has-mr-6">2</span>
        <span>Layout</span>
        </a></li><li>
        <a class="is-flex" href="#å†æ¢RequestLayout">
        <span class="has-mr-6">3</span>
        <span>å†æ¢RequestLayout</span>
        </a></li></ul>
        </div>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                    
                    <img src="/assets/img/logo.jpg" alt="Viewå·¥ä½œæµç¨‹[äºŒ]ï¼šMeasureå¸ƒå±€" height="28" style="margin-left: 0.5em">
                    
                </a>
                <p class="is-size-7" style="padding-bottom: 0.5em">
                    <span id="timeDate" class="is-size-7"></span>
                    <span id="times" class="is-size-7"></span>
                </p>
                <p class="is-size-7">
                    &copy; 2019 John Pig&nbsp;
                    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                    
                </p>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                <script>
                    var now = new Date();
                    function createtime() {
                        var grt = new Date("7/24/2019 16:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´ 
                        now.setTime(now.getTime() + 250);
                        days = (now - grt) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
                        hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
                        if (String(hnum).length == 1) { hnum = "0" + hnum; } minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
                        mnum = Math.floor(minutes); if (String(mnum).length == 1) { mnum = "0" + mnum; }
                        seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
                        snum = Math.round(seconds); if (String(snum).length == 1) { snum = "0" + snum; }
                        document.getElementById("timeDate").innerHTML = "&nbsp;&nbsp" + "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + dnum + " å¤© ";
                        document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
                    }
                    setInterval("createtime()", 250);
                </script>
            </div>
            <div class="level-end">
                
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'æ–‡ç« ',
                PAGES: 'é¡µé¢',
                CATEGORIES: 'åˆ†ç±»',
                TAGS: 'æ ‡ç­¾',
                UNTITLED: '(æ— æ ‡é¢˜)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"mobile":{"show":false},"model":{"scale":0.7,"jsonPath":"/live2dw/assets/hijiki.model.json"},"log":false});</script></body>
</html>